{% extends 'base.html' %} 

{% block header %}
    {# Incluye la barra de navegación superior que usa el diseño prototipo #}
    {% include 'layouts/navbar.html' %} 
{% endblock %}

{% block sidebar %}
{# CRÍTICO: USAR LA CLASE PROTOTIPO DEFINIDA EN TU CSS #}
<aside class="prototipo-sidebar"> 
    <div class="sidebar">
        
        {# ESTRUCTURA DEL PERFIL DE USUARIO - Usando clases del CSS de prototipo #}
        <div class="sidebar-user-info">
            <div class="profile-circle">
                <i class="fas fa-user-circle"></i> 
            </div>
            <div class="user-name">
                {# Aplicamos el fallback final para asegurar que se vea el nombre #}
                {{ current_user.nombre_completo or current_user.username }}
            </div>
            <div class="last-login">
                Último login: {{ current_user.fecha_ultimo_login.strftime('%Y-%m-%d') if current_user.fecha_ultimo_login else 'Nunca' }}
            </div>
        </div>
        
        <nav class="sidebar-menu">
            <ul class="list-group list-group-flush">
                
                <li class="menu-heading">PANEL DE SISTEMAS</li>
                
                {# Enlaces usan las clases prototipo: list-group-item #}
                
                {# 1. Dashboard Principal #}
                <a href="{{ url_for('sistemas.dashboard') }}" class="list-group-item {% if request.endpoint == 'sistemas.dashboard' %}active{% endif %}">
                    <i class="fas fa-desktop"></i>
                    Dashboard
                </a>
                
                <li class="menu-heading">ADMINISTRACIÓN TÉCNICA</li>
                
                {# 2. GESTIÓN DE USUARIOS #}
                <a href="{{ url_for('sistemas.gestionar_usuarios') }}" class="list-group-item {% if 'usuarios' in request.endpoint %}active{% endif %}">
                    <i class="fas fa-users-cog"></i>
                    Gestión de Usuarios
                </a>
                
                {# 3. REGISTRO DE AUDITORÍA #}
                <a href="{{ url_for('sistemas.auditoria') }}" class="list-group-item {% if request.endpoint == 'sistemas.auditoria' %}active{% endif %}">
                    <i class="fas fa-shield-alt"></i>
                    Logs de Actividad
                </a>
                
                {# 4. SOLICITUDES PENDIENTES #}
                <a href="{{ url_for('sistemas.solicitudes_pendientes') }}" class="list-group-item {% if request.endpoint == 'sistemas.solicitudes_pendientes' %}active{% endif %}">
                    <i class="fas fa-envelope-open-text"></i>
                    Solicitudes Pendientes
                </a>
                
                {# 5. GESTIÓN BD & BACKUPS #}
                <a href="{{ url_for('sistemas.gestion_backups') }}" class="list-group-item {% if 'backup' in request.endpoint %}active{% endif %}">
                    <i class="fas fa-database"></i>
                    Gestión BD & Backups
                </a>

                <li class="menu-heading">SESIÓN</li>
                
                {# Enlace de Salida (Logout) #}
                <a href="{{ url_for('auth.logout') }}" class="list-group-item text-danger">
                    <i class="fas fa-sign-out-alt"></i>
                    Cerrar Sesión
                </a>
                
            </ul>
        </nav>
    </div>
</aside>
{% endblock %}

{# El resto de los bloques 'content_area' y 'flash messages' permanecen igual #}

{% block content_area %}
    {# Bloque para Flash Messages (Alertas) #}{# ... #}

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container-fluid pt-3">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    {% block dashboard_content %}{% endblock %} 
{% endblock %}