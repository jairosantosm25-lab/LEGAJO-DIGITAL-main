{% extends 'layouts/base.html' %}
{% block title %}Iniciar Sesión - LegajoDigital{% endblock %}

{% block body_content %}
<div class="login-container">

    <div class="login-box">
        <div class="text-center mb-4">
            <img src="{{ url_for('static', filename='img/Logo-Diresa-Pasco.png') }}" alt="DIRESA Pasco Logo Grande" class="login-logo-diresa">
            <h3 class="fw-bold">Legajo Digital DIRESA</h3>
            <p class="text-muted">HECHO POR MUÑOZ PACORI :V </p>
        </div>
        <form method="post" novalidate>
            {{ form.hidden_tag() }}
            
            <div class="form-floating">
                {{ form.username(class="form-control", placeholder="Usuario") }}
                {{ form.username.label }}
            </div>
            
            <div class="form-floating mt-3">
                {{ form.password(class="form-control", placeholder="Contraseña") }}
                {{ form.password.label }}
            </div>

            {# Sección del CAPTCHA #}
            <div class="mt-3">
                <div class="captcha-box d-flex align-items-center justify-content-between p-2 border rounded">
                    {# Aquí se carga la imagen del CAPTCHA (placeholder) #}
                    <img src="{{ url_for('static', filename='img/captcha_prueba.png') }}" alt="CAPTCHA" class="captcha-img" id="captcha-img">
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="refresh-captcha" title="Recargar CAPTCHA">
                        <i class="bi bi-arrow-clockwise"></i>
                    </button>
                </div>
            </div>
            <div class="form-floating mt-3">
                <input type="text" id="captcha" name="captcha" class="form-control" placeholder="CAPTCHA" required>
                <label for="captcha">CAPTCHA</label>
            </div>
            {# Fin Sección CAPTCHA #}
            
            <div class="d-grid mt-4">
                {{ form.submit(class="btn btn-primary btn-lg") }}
            </div>

            <div class="text-center mt-3">
                <a href="#">¿Olvidaste tu contraseña?</a>
            </div>
        </form>
        <div class="text-center mt-4">
            <small class="text-muted">&copy; 2025 Todos los derechos reservados.</small>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // Lógica simple para recargar el CAPTCHA (solo visual)
    document.addEventListener('DOMContentLoaded', function() {
        const refreshCaptchaButton = document.getElementById('refresh-captcha');
        if (refreshCaptchaButton) {
            refreshCaptchaButton.addEventListener('click', function() {
                // En una aplicación real, harías una petición AJAX aquí
                // para obtener una nueva imagen de CAPTCHA del servidor.
                alert('Recargando CAPTCHA (funcionalidad de placeholder)'); 
                const captchaImg = document.getElementById('captcha-img');
                // Añade un timestamp para forzar al navegador a cargar una nueva imagen
                captchaImg.src = "{{ url_for('static', filename='img/captcha_prueba.png') }}?" + new Date().getTime();
            });
        }
    });
</script>
{% endblock %}